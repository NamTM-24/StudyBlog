<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/style.css" />
    <title>Quên mật khẩu</title>
  </head>
  <body>
    <section>
      <!-- Hiệu ứng lá rơi -->
      <div class="leaves">
        <div class="set">
          <div><img src="/images/leaf_01.png" /></div>
          <div><img src="/images/leaf_02.png" /></div>
          <div><img src="/images/leaf_03.png" /></div>
          <div><img src="/images/leaf_04.png" /></div>
          <div><img src="/images/leaf_01.png" /></div>
          <div><img src="/images/leaf_02.png" /></div>
          <div><img src="/images/leaf_03.png" /></div>
          <div><img src="/images/leaf_04.png" /></div>
        </div>
      </div>
      <!-- Ảnh nền -->
      <img src="/images/bg.jpg" class="bg" />
      <!-- Ảnh cô gái -->
      <img src="/images/girl.png" class="girl" />
      <!-- Ảnh cây -->
      <img src="/images/trees.png" class="trees" />

      <!-- Form quên mật khẩu -->
      <div class="login">
        <h2>Quên mật khẩu</h2>

        <% if (typeof success !== 'undefined' && success) { %>
        <div
          style="
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid #c3e6cb;
          "
        >
          <strong>Thành công!</strong><br />
          <%= success %> <% if (typeof message !== 'undefined' && message) { %>
          <br /><%= message %> <% } %>
        </div>
        <% } %> <% if (typeof error !== 'undefined' && error) { %>
        <div
          style="
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid #f5c6cb;
          "
        >
          <strong>Lỗi!</strong><br />
          <%= error %>
        </div>
        <% } %>

        <!-- Form nhập email -->
        <% if (typeof showCodeForm === 'undefined' || showCodeForm !== true) {
        %>
        <form action="/forgot-password" method="POST">
          <div class="inputBox">
            <input type="email" name="email" placeholder="Email" required />
          </div>
          <div class="inputBox">
            <input type="submit" value="Gửi yêu cầu" id="btn" />
          </div>
        </form>
        <% } %>

        <!-- Form nhập mã xác nhận -->
        <% if (typeof showCodeForm !== 'undefined' && showCodeForm === true) {
        %>
        <div
          style="
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
          "
        >
          <h3 style="color: #333; text-align: center; margin-bottom: 15px">
            Nhập mã xác nhận
          </h3>
          <p
            style="
              color: #666;
              text-align: center;
              margin-bottom: 20px;
              font-size: 14px;
            "
          >
            Vui lòng nhập mã 6 số đã được gửi đến email của bạn
          </p>

          <form action="/verify-code" method="POST">
            <input type="hidden" name="token" value="<%= token %>" />
            <div class="inputBox">
              <input
                type="text"
                name="code"
                placeholder="Nhập mã 6 số"
                maxlength="6"
                pattern="[0-9]{6}"
                style="
                  text-align: center;
                  letter-spacing: 8px;
                  font-size: 24px;
                  font-weight: bold;
                "
                required
              />
            </div>
            <div class="inputBox">
              <input type="submit" value="Xác nhận mã" id="btn" />
            </div>
          </form>
        </div>
        <% } %>

        <div class="group">
          <a href="/login">Quay lại đăng nhập</a>
          <a href="/register">Đăng ký</a>
        </div>
      </div>
    </section>

    <script>
      // Auto focus vào input code nếu có
      const codeInput = document.querySelector('input[name="code"]');
      if (codeInput) {
        codeInput.focus();

        // Chỉ cho phép nhập số
        codeInput.addEventListener("input", function (e) {
          this.value = this.value.replace(/[^0-9]/g, "");
        });

        // Auto submit khi nhập đủ 6 số
        codeInput.addEventListener("input", function (e) {
          if (this.value.length === 6) {
            setTimeout(() => {
              this.form.submit();
            }, 500);
          }
        });
      }
    </script>
  </body>
</html>
